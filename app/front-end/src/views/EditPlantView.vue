<template>
    <section class="contact">
        <div class="info-contact">
            <hr>
            <h1>Éditer une plante</h1>
            <p>Le site étant communautaire, certaines informations peuvent être fausses. Si c'est le cas, nous vous
                remercions de mettre à jours ces informations</p>

            <img src="@/assets/deco-top-add-plant.png" alt="feuilles" class="img1" />
            <img src="@/assets/deco-bottom-add-plant.png" alt="fleur" class="img2" />
        </div>
        <div class="contact-form">
            <img src="@/assets/deco-add-plant.png" alt="déco" class="img-deco" />
            <div class="container-form">
                <form v-if="!isLoading" @submit.prevent="addPlant">
                    <!-- Ajouter une image -->
                    <div class="plant-names">
                        <div class="form-group">
                            <label for="scientific_name">Nom scientifique</label>
                            <input type="text" id="scientific_name" v-model="plant.scientific_name"
                                placeholder="test" />
                        </div>
                        <div class="form-group">
                            <label for="common_name">Nom commun</label>
                            <input type="text" id="common_name" v-model="plant.common_name" />
                        </div>
                    </div>
                    <div class="family-genus">

                        <div class="form-group">
                            <label for="family">Famille</label>
                            <input type="text" id="family" v-model="plant.family" />
                        </div>
                        <div class="form-group">
                            <label for="genus">Gènes</label>
                            <select name="genus" id="genus" v-model="plant.genusTab">
                                <option value="">Choisir un gène</option>
                                <option v-for="genus in genusTab" :key="genus" :value="genus">
                                    {{ genus.name }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="year">Dépôt du nom</label>
                        <input type="number" id="year" v-model="plant.year" />
                    </div>

                    <div class="form-group">
                        <label for="bibliography">Bibliographie</label>
                        <input type="text" id="bibliography" v-model="plant.bibliography" />
                    </div>
                    <div class="form-group">
                        <label for="author">Autheur</label>
                        <input type="text" id="author" v-model="plant.author" />
                    </div>
                    <div class="form-group">
                        <label for="image">Image</label>
                        <input type="file" id="image" @change="handleImageChange" />
                    </div>
                    <input type="submit" value="Éditer la plante"></input>
                </form>
                <div class="loader" v-else>
                    <p>Chargement des informations en cours...</p>
                </div>
            </div>
        </div>

    </section>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter, useRoute } from 'vue-router';
import Swal from 'sweetalert2';

const router = useRouter();
const route = useRoute();

const plant = ref({
    common_name: '',
    scientific_name: '',
    family: '',
    year: 1924,
    genusTab: '',
    bibliography: '',
    image_url: ''
})

const isLoading = ref(true);

async function addPlant() {
    let response = await fetch('http://localhost:8001/api/plants/' + route.params.id, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(plant.value),
    });
    response = await response.json();
    // Use `router` instead of `this.$router`
    Swal.fire({
        title: "Plante modifiée !",
        text: "Nous vous remercions pour votre contribution.",
        icon: "success",
        willClose: () => {
            router.push('/plants/' + route.params.id);
        }
    });

}

const genusTab = ref([]);

onMounted(async () => {
    let response = await fetch('http://localhost:8001/api/genus');
    let responsePlant = await fetch('http://localhost:8001/api/plants/' + route.params.id);
    responsePlant = await responsePlant.json();
    response = await response.json();
    genusTab.value = response;
    responsePlant.genusTab = {
        id: responsePlant.genus_id,
        name: responsePlant.genus
    };
    plant.value = responsePlant;
    isLoading.value = false;
});

function handleImageChange(event) {
    // Interface JS pour lire des fichiers (c'est asynchrone)
    const reader = new FileReader();
    reader.onload = (e) => {
        plant.value.image_url = e.target.result;
    };
}
</script>

<style scoped>
section {
    display: flex;
    flex-direction: row-reverse;
    align-items: center;
    padding: 0;
    height: calc(90dvh - 2px);
}

.plant-names,
.family-genus {
    display: flex;
    width: 100%;
    gap: 1rem;
}

.plant-names div,
.family-genus div {
    width: 50%;
}

.container-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    width: 70%;
    padding: 2rem 2rem;
    border-radius: 5px;
    background-color: #DADDD8;
}

.info-contact {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    width: 40%;
    height: 100%;
    padding: 5rem 2rem;
    position: relative;
    overflow: hidden;
    justify-content: center;
}

.info-contact hr {
    width: 100%;
    height: 2px;
    background-color: #A7D5AF;
    border: none;
}

.info-contact h1 {
    font-size: 3rem;
    color: #10552D;
}

.info-contact p {
    color: #10552D;
    font-size: 1.1rem;
}

.info-contact img {
    position: absolute;
    /* Changer la saturation */
    filter: saturate(0.6);
}

.info-contact img.img1 {
    top: -10rem;
    right: -10rem;
    width: 30rem;
    transform: rotate(-10deg);
}

.info-contact img.img2 {
    bottom: -12rem;
    left: -15rem;
    width: 40rem;
}

.contact-form {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 60%;
    height: 100%;
    background: #10552D;
    justify-content: center;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.contact-form img.img-deco {
    z-index: -1;
    position: absolute;
    width: 15rem;
    top: -10rem;
    left: 0;
    transform: rotate(-20deg);
    filter: saturate(0.8);
}

form {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

label {
    font-size: 0.9rem;
    font-weight: 300;
}

input[type="submit"] {
    background-color: #10552D;
    box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0.12) 0px 1px 1px 0px, #10552D 0px 0px 0px 1px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(0, 0, 0, 0) 0px 0px 0px 0px, rgba(60, 66, 87, 0.08) 0px 2px 5px 0px;
    color: #DADDD8;
    font-weight: 600;
    cursor: pointer;
}

input[type="submit"]:hover {
    background-color: #0A3A1A;
}

.loader {
    display: flex;
    justify-content: center;
    align-items: center;
    color: #10552D;
    font-family: "Playfair Display", serif;
    font-weight: 400;
    font-size: 1.2rem;
}
</style>